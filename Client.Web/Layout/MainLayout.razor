@using System.Security.Claims

@inherits LayoutComponentBase

<MudThemeProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<style>
    body {
        background-color: #F4F6F7;
    }
</style>

<MudLayout >
    <MudAppBar Elevation="1">
        <AuthorizeView>
            <Authorized>
                <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="@((e) => DrawerToggle())" />
            </Authorized>
        </AuthorizeView>
        <MudText Typo="Typo.h5" Class="ml-3">EasyMove</MudText>
        <AuthorizeView>
            <Authorized>
                @{
                    var userName = @context.User.Claims.FirstOrDefault(c => c.Type == ClaimTypes.Name)?.Value;
                }
                <MudSpacer />
                <MudText>@userName</MudText>
                <div>
                    <MudIconButton OnClick="@ProfileToggle" Icon="@Icons.Material.Filled.AccountCircle" Color="Color.Inherit" Size="Size.Large"/>
                    <MudPopover Open="@_profileOpen" Fixed="true" Style="width: 300px; padding: 16px;" Class="px-4 pt-4" AnchorOrigin="Origin.BottomRight" TransformOrigin="Origin.TopRight">
                        <div class="d-flex flex-column">
                            <div style="display: flex;align-items: center;justify-content: flex-start; margin-bottom: 15px;">
                                <MudAvatar Color="Color.Primary" Icon="@Icons.Material.Filled.AccountCircle">
                                    <MudIcon Icon="@Icons.Material.Filled.AccountCircle" Color="Color.Inherit" Size="Size.Large" />
                                </MudAvatar>
                                <div style="margin-left: 15px;">
                                    <div style="font-weight: 500;font-size: 16px; color: #202C3C">@userName</div>
                                    <div style="font-weight: 400;font-size: 14px;color: #878E98">Администратор</div>
                                </div>
                            </div>
                            <MudButton OnClick="(() => HandleLogout())" Variant="Variant.Text" StartIcon="@Icons.Material.Filled.ExitToApp" IconColor="Color.Primary" IconSize="Size.Large">Выйти</MudButton>
                        </div>
                    </MudPopover>
                </div>
            </Authorized>
        </AuthorizeView>
    </MudAppBar>
    <AuthorizeView>
        <Authorized>
            <MudDrawer @bind-Open="_drawerOpen" ClipMode="DrawerClipMode.Always" Elevation="2">
                <NavMenu />
            </MudDrawer>
        </Authorized>
    </AuthorizeView>
    <MudMainContent>
        @Body
    </MudMainContent>
</MudLayout>

@code {
    private bool _profileOpen = false;
    private bool _drawerOpen = true;

    private void ProfileToggle() => _profileOpen = !_profileOpen;

    private void DrawerToggle() => _drawerOpen = !_drawerOpen;

    private async Task HandleLogout()
    {
    }
}
