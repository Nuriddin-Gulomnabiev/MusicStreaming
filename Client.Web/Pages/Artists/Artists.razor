@page "/"
@page "/artists"

@using Client.Web.Services.ApiHttpService.Models.ModelResponse

@attribute [Authorize]

@inject ApiHttpService HttpService
@inject NavigationManager Navigation

<div style="padding: 40px">
    <MudText Typo="Typo.h4" Class="mb-4 font-bold">🎵 Список артистов</MudText>

    @if (isLoading)
    {
        <div class="flex justify-center items-center" style="height:200px;">
            <MudProgressCircular Indeterminate="true" Color="Color.Primary" Size="Size.Large" />
        </div>
    }
    else if (artists is not null)
    {
        <MudGrid>
            @foreach (var artist in artists)
            {
                <MudItem xs="12" sm="4" md="3" lg="2">
                    <MudPaper Class="artist-card transition-all hover:scale-105 hover:shadow-xl"
                              Elevation="1"
                              onclick="@(() => GoToArtist(artist.Code))">
                        <div class="avatar" style="background-color:@GetRandomColor(artist.Code)">
                            @artist.Name[0]
                        </div>
                        <MudText Typo="Typo.subtitle1" Class="mt-3 font-semibold">@artist.Name</MudText>
                        <MudText Typo="Typo.caption" Color="Color.Secondary">@artist.AlbumCount альбомов</MudText>
                    </MudPaper>
                </MudItem>
            }
        </MudGrid>
    }
    else
    {
        <MudText Color="Color.Error">Не удалось загрузить артистов</MudText>
    }
</div>



<style>
    .artist-card {
        text-align: center;
        border-radius: 20px;
        padding: 24px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

        .artist-card:hover {
            background-color: #f5f5f5;
        }

    .avatar {
        margin: 0 auto;
        width: 90px;
        height: 90px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 36px;
        color: white;
        font-weight: bold;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
</style>
@code {
    private List<ArtistModelResponse> artists;
    private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        var response = await HttpService.GetAsync<List<ArtistModelResponse>>("/api/v1/artists");

        if (response.Success)
            artists = response.Data;
        else
            Console.WriteLine(response.ErrorMessage);

        isLoading = false;
    }

    private void GoToArtist(int code)
    {
        Navigation.NavigateTo($"/artist/{code}");
    }

    private string GetRandomColor(int seed)
    {
        var colors = new[]
        {
            "#EF5350", "#AB47BC", "#5C6BC0", "#29B6F6",
            "#66BB6A", "#FFCA28", "#FF7043", "#8D6E63",
            "#78909C", "#EC407A"
        };

        return colors[seed % colors.Length];
    }
}
